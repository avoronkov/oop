<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Seminar 5 - OOP Practice Docs</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">OOP Practice Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Seminars <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../seminar1/">Seminar 1</a>
</li>

                        
                            
<li >
    <a href="../seminar2/">Seminar 2</a>
</li>

                        
                            
<li >
    <a href="../seminar3/">Seminar 3</a>
</li>

                        
                            
<li class="active">
    <a href="./">Seminar 5</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Extras <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../assembla/">Acceptance</a>
</li>

                        
                            
<li >
    <a href="../using-namespaces/">Using namespaces</a>
</li>

                        
                            
<li >
    <a href="../cmake/">CMake</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../seminar3/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../assembla/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#5-02102015">Семинар 5 (02.10.2015)</a></li>
        
            <li><a href="#_1">Типичные ошибки</a></li>
        
            <li><a href="#_2">Пожелания</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="5-02102015">Семинар 5 (02.10.2015)</h1>
<h2 id="_1">Типичные ошибки</h2>
<p>Обращайте внимание не только на ошибки, выдаваемые компилятором, но и на <strong>предупреждения (warnings)</strong>.
Поищите, как в вашей рабочей среде настроить компилятор так, чтобы он выдавал предупреждения.
Например, при использовании <em>gcc</em> (<code>g++</code>) под Linux или при использовании <em>mingw</em> в Windows,
вывод всех предупреждений включается опцией <code>-Wall</code>:</p>
<pre><code>g++ -std=c++14 -Wall source1.cpp source2.cpp ...
</code></pre>

<p>Многое из того, что сообщает компилятор указывает на логические ошибки в коде.
Например:</p>
<pre><code>В функции-члене «LinkedList::iterator&amp; LinkedList::iterator::operator++()»:
предупреждение: присваивание, используемое как логическое выражение, рекомендуется  [-Wparentheses]
     if (this-&gt;element = NULL)
                             ^
</code></pre>

<p>Скорее всего, <strong>вместо присваивания</strong> (<code>=</code>) в этой строке подразумевалось <strong>сравнение</strong> (<code>==</code>).
В таком виде блок кода идущий после <code>if (...)</code> никогда не будет выполнен.</p>
<p>Ещё пример:</p>
<pre><code>В функции-члене «LinkedList::iterator LinkedList::iterator::operator++(int)»:
предупреждение: control reaches end of non-void function [-Wreturn-type]
 }
 ^
</code></pre>

<p><strong>Нет возвращаемого значения</strong> при выходе из не-void функции,
что будет делать программа при вызове этого метода скорее всего неопределено.</p>
<p><strong>Не используйте функцию <code>memcpy</code></strong> для копирования объектов, для этого есть оператор присваивания (<code>operator=</code>)
и возможность его перегрузить.</p>
<p>При <strong>копировании итератора</strong> (с использованием констуктора <code>iterator(const iterator &amp;)</code> или оператора присваивания
<code>iterator &amp; operator=(const iterator&amp;)</code>) не нужно копировать узел (<em>Node</em>), на который указывает итератор.
Например, если <code>iterator</code> содержит поля:</p>
<pre><code>class iterator {
    Node * node;
}
</code></pre>

<p>то при копировании итератора нужно просто скопировать указатель:</p>
<pre><code>iterator(const iterator &amp; other): node(other.node) {
}

iterator &amp; operator=(const iterator &amp; other) {
    this-&gt;node = other.node;
}
</code></pre>

<p>Кстати, в точности то же самое сделает <code>default</code>:</p>
<pre><code>iterator(const iterator &amp; other): node(other.node) = default;
iterator &amp; operator=(const iterator &amp; other) = default;
</code></pre>

<p>Объяснение достаточно простое: итератор не владеет "узлом" с данными, на который он указывает.
Данными владеет класс <code>LinkedList</code>.
По этой же причине при деструктор итератора (<code>~iterator()</code>) не должен удалять "узел".</p>
<p><strong>Операторы <code>+</code> и <code>+=</code></strong>. Оператор <code>+</code> не изменяет содержимое ни одного из двух аргументов
и возвращает новый объект. Пример для чисел:</p>
<pre><code>int x = 10;
int y = 15;
int z = x + y;
// сожержимое x и y не изменилось. z содержит новое значение.
</code></pre>

<p>Оператор <code>+=</code> изменяет содержимое первого аргумента, но не трогает второе:</p>
<pre><code>int x = 10;
int y = 15
x += y;
// x содержит новое значение, значение y не изменилось.
</code></pre>

<p>Теперь к классам. Обратите внимание на сигнатуру операторов:</p>
<pre><code>    List operator+(const List &amp; other) const;
    List&amp; operator+=(const List &amp; other);
</code></pre>

<p><code>operator+</code> возвращает <code>List</code>, то есть новый объект, <code>operator+=</code> возвращает ссылку <code>List&amp;</code>.
Семантически это "ссылка на самого себя".
Что это значит? Это значит, то можно написать следующий код:</p>
<pre><code>string x = &quot;one&quot;;
(x += &quot;two&quot;) += &quot;three&quot;;
cout &lt;&lt; x &lt;&lt; endl;
// резутьтат: onetwothree
</code></pre>

<p>Если бы <code>operator+=</code> возвращал новый объект (<code>List</code>) вместо ссылки (<code>List&amp;</code>),
то при вызове <code>+= "three"</code> менялось содержимое не <code>x</code>, а этого нового объекта и результат был бы <code>onetwo</code>.</p>
<p>Можно определить оператор <code>+</code> через <code>+=</code> и конструктор копирования:</p>
<pre><code>List&amp; operator+=(const List &amp; other) {
    for (List::iterator it = other.begin(); it != other.end(); ++it) {
        this-&gt;push_back(*it);
    }
    return *this;
}

List operator+(const List &amp; other) const {
    List result(*this); // создаём копию &quot;этого&quot; списка
    result += other; // добавляем к копии &quot;другой&quot; список
    return result; // возвращаем результат
}
</code></pre>

<p><strong>Сравнение итераторов.</strong> В коде часто встречается конструкция <code>it != list.end()</code>.
Как правильно сравнить два итератора?
Во-первых, нужно помнить, что итераторы можно копировать.
Во-вторых, что значит "два итератора равны"?
В случае со списком это означает, что два итератора указывают на один и тот-же узел.
Как понять, что итераторы указывают на один и тот же узел?
Использовать "хитрый хак" - сравнить два указателя :)</p>
<pre><code>bool operator==(const iterator &amp; other) const {
    return this-&gt;node == other.node;
}
bool operator!=(const iterator &amp; other) const {
    return !((*this) == other);
}
</code></pre>

<p><em>Продолжение следует</em></p>
<h2 id="_2">Пожелания</h2>
<p><strong>Структуры с стиле C</strong>. Вместо</p>
<pre><code class="C++">typedef struct _MyStruct {
    int some_field;
} MyStruct;
</code></pre>

<p>можно писать просто</p>
<pre><code class="C++">struct MyStruct {
    int some_field;
};
</code></pre>

<p>Поскольку ключевое слово <code>struct</code> так же, как слово <code>class</code>, определяет класс, но с доступом <code>public</code> к членам класса по-умолчанию, последняя запись аналогична:</p>
<pre><code class="C++">class MyStruct {
public:
    int some_field;
};
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
